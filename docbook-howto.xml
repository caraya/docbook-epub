<?xml version="1.0" encoding="utf-8"?>
<book 
	xmlns='http://docbook.org/ns/docbook' 
	xmlns:xlink='http://www.w3.org/1999/xlink'
	version="5.0" xml:lang="en">
<title>Using From Docbook to ePub and Kindle too</title>
<info>
	<author>
		<personname>
			<firstname>Carlos</firstname><surname>Araya</surname>
		</personname>
	</author>
	</info>
<preface>
<title>Publishing for everyone</title>
<subtitle>Trying to get down to a definition of publishing</subtitle>

<para>Publishing is no longer the province of big publishers or that crazy people who dream of writing a book and find out that the only way to get published is to do it themselves. Well, we all can publish our work with tools like Docbook,  formats like ePub and publishers like Amazon.</para>

<para>We all have something to publish. We all have something to tell the world.</para>

<para>I chose to publish my content using Docbook because of it's flexibility. While we're talking only about ePub and Kindle publishing, Docbook can generate a variety of other formats using the same tools that we are using to generate our ePub content. You can learn more about Docbook and the associated XSLT style sheets at <link xlink:href="http://www.docbook.org/">http://www.docbook.org/</link>.</para>

<para>This e-book seeks to answer three questions that, to me, are essential to a successful publishing endeavor:</para>

<itemizedlist>
	<listitem>Why should I publish my own content?</listitem>
	<listitem>Why should I use Docbook to do it?</listitem>
	<listitem>How do I create my ebook using this tools?</listitem>
</itemizedlist>

<para>In answering these questions my hope is that you will create new content and give it to the world. I'm sure we'll all be much better for it</para>
</preface>

<chapter>
<title>Why should I create an ebook? Why with Docbook?</title>
<para>Again, We all have something to say to the world. And ebooks make it easier than ever to have the world as your audience. </para>
<sect1>
<title>Why Docbook?</title>
	<para>Content is required in chapters too.</para>
</sect1>
</chapter>

<chapter>
<title>Creating your Docbook content</title>
<para>Content is required in chapters too.</para>
<programlisting>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;book 
	xmlns='http://docbook.org/ns/docbook' 
	xmlns:xlink='http://www.w3.org/1999/xlink'
	version="5.0" xml:lang="en"&gt;
&lt;title&gt;Using From Docbook to ePub and Kindle too&lt;/title&gt;
&lt;info&gt;
	&lt;author&gt;
		&lt;personname&gt;
			&lt;firstname&gt;Carlos&lt;/firstname&gt;&lt;surname&gt;Araya&lt;/surname&gt;
		&lt;/personname&gt;
	&lt;/author&gt;
	&lt;/info&gt;
&lt;chapter&gt;
&lt;title&gt;Required Title&lt;/title&gt;

&lt;para&gt;Required paragraph.&lt;/para&gt;

&lt;/chapter&gt;
</programlisting>
</chapter>

<chapter>
<title>Converting the XML into different formats</title>
	<para>something interesting goes here</para>

<sect1>
	<title>Converting to ePub 2</title>
	<para>Content is required in chapters too.</para>
</sect1>

<sect1>
<title>Making an ePub3 ebook </title>
	<para>Content is required in chapters too.</para>
</sect1>

<sect1>
<title>Let's not forget the Kindle</title>
	<para>Content is required in chapters too.</para>
</sect1>
</chapter>

<chapter>
<title>Customizing the generated HTML</title>
	<para>Content is required in chapters too.</para>
</chapter>

<chapter>
	<title>Automating the process</title>

<para>Because I'm paranoid and I like to build my book over and over I found out a problem. If I accidentally delete any of the directories that Docbook creates for me, the build process will fail. However, removing the existing files and directories is essential to ensure that only the latest version of our generated files makes it into the ebook.</para>
	
<para>I decided to use the If ant task from the Ant Contrib Project. Download links and instructions for installing the additional tasks and configuring your build file to use them see <link xlink:href="http://ant-contrib.sourceforge.net/">http://ant-contrib.sourceforge.net/</link>.</para>

<para></para>
<programlisting><project name="epub" default="epub3" basedir=".">
<description>
Apache ant build file for Docbook based ebooks
</description>
<!-- Created by Carlos Araya as part of his eBook research -->

<!-- Required for the IF Task -->
<taskdef resource="net/sf/antcontrib/antcontrib.properties"/>
<!-- Change the value of src_file to the name of your ebook file without extension-->
<property name="src_file" value="docbook-howto"/>

<!-- Put the name of the binaries that you're using that are not stock on OS X-->
<property name="epubcheck_bin" value="/usr/local/java/epubcheck/epubcheck-3.0b4.jar"/>
<property name="kindlegen_bin" value="/usr/local/kindlegen/kindlegen"/>

<target name="epub2">
<description>
	Convert the XML file into epub2 using a snapshot of the stylesheets
</description>
<!-- Remove prior versions of the content we're generating -->
<antcall target="epub-clean"/>
<!-- Validate XML -->
<antcall target="validate-xml"/>
<!-- Run the stylesheet conversion -->
<exec executable="xsltproc">
	<arg line="/usr/local/docbook/1.0/xslt/epub/docbook.xsl ${src_file}.xml"/>
</exec>
<!-- Create mimetype file, required per epub spec -->
<antcall target="make-mime"/>
<!-- zips the fills for the epub -->
<antcall target="epub-zip"/>
<!-- Runs epubcheck on the epub file -->
<antcall target="epub-check"/>
<!-- Creates a Kindle version of the book -->
<antcall target="make-kindle"/>
</target>

<target name="epub3">
<description>
	Convert the XML file into epub3 using a snapshot of the stylesheets. 
	We do it with snapshot because epub3 support is still experimental
</description>
<!-- Remove prior versions of the content we're generating -->
<antcall target="epub-clean"/>
<!-- Validate XML -->
<antcall target="validate-xml"/>
<!-- Run the xslt transformation... we should be able to use the XSLT ant task xsltproc is faster
-->
<exec executable="xsltproc">
	<arg line="--stringparam base.dir OEBPS/ /usr/local/docbook/1.0/xslt/epub3/chunk.xsl ${src_file}.xml"/>
</exec>
<!-- zips the fils for the epub -->
<antcall target="epub-zip"/>
<!-- Runs epubcheck on the epub file -->
<antcall target="epub-check"/>
</target>


<!-- Utility targets called from elsewhere epub2 and epub3 targets-->
<target name="make-mime">
<!-- Creates mimetype file as required by epub spec-->
<echo file="mimetype">application/epub+zip</echo>
</target>

<target name="make-kindle">
<exec executable="${kindlegen_bin}">
	<arg line="${src_file}.epub"/>
</exec>
</target>

<target name="epub-zip">
<!-- We use exec zip because I can't figure out if the builtin zip task conforms to what ePub expects -->
<!-- Zip the mimetype first without compression as required-->
<exec executable="zip">
<arg line="-X0 ${src_file}.epub mimetype"/>
</exec>
<!-- Then zip the other files into the zip/epub archive -->
<exec executable="zip">
<arg line="-r -X9 ${src_file}.epub META-INF OEBPS"/>
</exec>
</target>

<target name="epub-check">
<java jar="${epubcheck_bin}" fork="true" failonerror="true" maxmemory="128m">
	<arg value="${src_file}.epub"/>
</java>
</target>

<!-- Cleans up leftover epub stuff-->
<target name="epub-clean">
<description>
	Cleans up leftover epub stuff
</description>
<if>
	<!-- 
	If OEBPS exists we assume the other files and directories do as well
	since Docbook would never create only OEBPS

	The if tasks uses ant-contrib available from sourceforge.net. 
	See the section on Automating the process for more information and about what 
	changes to make if you don't want to use the task
	-->
	<available file="OEBPS" type="dir" />
	<then>
		<echo message="Directory exist... deleting" />
		<delete verbose="true">
			<fileset dir="OEBPS" includes="*"/>
			<fileset dir="META-INF" includes="*"/>
		</delete>
		<delete verbose="true" file="mimetype"/>
		<delete verbose="true" dir="META-INF"/>
		<delete verbose="true" dir="OEBPS"/>
		<delete verbose="true" file="${src_file}.epub"/>
	</then>
	<else>
		<echo message="Directory DOES NOT exist... skipping" />
	</else>
</if>
</target>

<!-- We call xmllint to make sure that the XML validates-->
<target name="validate-xml">
<exec executable="xmllint">
	<arg line="-noent -noout ${src_file}.xml"/>
</exec>
</target>
</project></programlisting>
</chapter>

<chapter>
<title>Publishing your content</title>

<para>This is where we talk about publishing your content yourself, publishing to Amazon and, maybe, to the iBooks store</para>
</chapter>

<bibliography>
<title>References</title>

<bibliomixed>
	<bibliomset relation='book'>Sayton, Robert.
 		<title role='book'>Introduction to Cascading Style Sheets</title>.
	</bibliomset>
	<bibliomset relation='journal'>
		<title>The World Wide Web Journal</title>
		<volumenum>2</volumenum><issuenum>1</issuenum>.
		<publishername>O'Reilly &amp; Associates, Inc.</publishername> and The World Wide Web Consortium. Winter, 1996</bibliomset>.
	</bibliomixed>
</bibliography>

<!--
<colophon>
<para>Draft versions of the first edition of this book were produced with the DocBook DSSSL Stylesheets. Final production was performed with Troff.</para>
<para>XSLT and XSL were used to produce the second edition.</para>
</colophon>
-->
</book>